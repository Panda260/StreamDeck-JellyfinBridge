services:
  jellyfin-bridge:
    build: .
    container_name: jellyfin-bridge
    environment:
      JELLYFIN_URL: "http://jellyfin:8096"
      JELLYFIN_API_KEY: "replace-with-jellyfin-api-key"
      HA_URL: "http://homeassistant:8123"
      HA_TOKEN: "replace-with-homeassistant-token"
      SYNC_INTERVAL_SECONDS: 300
      HA_ENTITY_USERS: "counter.jellyfin_users"
      HA_ENTITY_MOVIES: "counter.jellyfin_movies"
      HA_ENTITY_SERIES: "counter.jellyfin_series"
      HA_ENTITY_EPISODES: "counter.jellyfin_episodes"
      # Optional ZFS metrics
      ENABLE_ZFS: "true"
      ZFS_POOL: "tank"
      HA_ENTITY_ZFS_HEALTH: "input_text.zfs_pool_health"
      HA_ENTITY_ZFS_CAPACITY: "input_number.zfs_pool_capacity"
    volumes:
      # Provide the zpool binary and device read-only so the container can query the pool
      # Detect the host path with: command -v zpool (commonly /sbin/zpool or /usr/sbin/zpool)
      # Mount the containing directory, not a single file, to avoid read-only filesystem errors if the path is wrong.
      - /sbin:/sbin:ro     # replace /sbin with $(dirname $(command -v zpool)) from your host
      - /dev/zfs:/dev/zfs:ro
    restart: unless-stopped
