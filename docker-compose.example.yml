services:
  jellyfin-bridge:
    build: .
    container_name: jellyfin-bridge
    environment:
      JELLYFIN_URL: "http://jellyfin:8096"
      JELLYFIN_API_KEY: "replace-with-jellyfin-api-key"
      HA_URL: "http://homeassistant:8123"
      HA_TOKEN: "replace-with-homeassistant-token"
      SYNC_INTERVAL_SECONDS: 300
      HA_ENTITY_USERS: "counter.jellyfin_users"
      HA_ENTITY_MOVIES: "counter.jellyfin_movies"
      HA_ENTITY_SERIES: "counter.jellyfin_series"
      HA_ENTITY_EPISODES: "counter.jellyfin_episodes"
      # Optional ZFS metrics
      ENABLE_ZFS: "true"
      ZFS_POOL: "tank"
      HA_ENTITY_ZFS_HEALTH: "input_text.zfs_pool_health"
      HA_ENTITY_ZFS_CAPACITY: "input_number.zfs_pool_capacity"
    volumes:
      # Provide zpool binary and device read-only so the container can query the pool
      # Replace /usr/sbin/zpool with the path from `command -v zpool` on your host if different
      - /usr/sbin/zpool:/usr/sbin/zpool:ro
      - /dev/zfs:/dev/zfs:ro
    restart: unless-stopped
